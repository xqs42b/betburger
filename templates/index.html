<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>首页</title>
    <link rel="stylesheet" href="/static/layer/theme/default/layer.css">
    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
    <script src="/static/js/jquery-3.3.1.js"></script>
    <script src="/static/layer/layer.js"></script>
    <script src="/static/js/bootstrap.min.js"></script>
    <style>
        body {
            color: #555;
            margin-top: 10px;
        }

        @media(min-width: 1300px) {
            .container {
                width: 1300px
            }
        }

        .table {
            border-collapse: collapse；
        }

        /* td {
            overflow: hidden;
        } */

        .form-signin {
            max-width: 330px;
            padding: 15px;
            margin: 0 auto;
        }

        .form-control {
            margin-top: 6px;
            height: 50px;
        }
        .now_active {
            background-color: gray;
        }
        .header_banner {
            background-color: rgb(54, 95, 129);
        }
        .sites > label {
            margin-left: 10px;
        }
    </style>
</head>
<body>
    <div class='container' style="height: 1400px;">
        <div class="btns" style="margin-bottom:6px;">
            <button class='btn_login btn btn-primary' style="display: none;">登录</button>
            <button class='btn_logout btn btn-primary'>退出</button>
            <button class='btn_sites btn btn-primary'>网址选择</button>
        </div>
        <div class="col-md-6 col-md-push-6" style='height:240px; border:3px solid #444; padding: 3px;'>
            <table class='table table-condensed calculator' style='display: none;'>
            <!-- <table class='table table-condensed calculator' > -->
                <tr>
                    <td>
                        <b>Soccer</b>
                        <br>
                        <br>
                        <b>100%</b>
                    </td>
                    <td colspan="5">
                        <b homeaway2=''><span style="cursor: pointer;color:black;" class='copy_home1'>china</span> - <span class='copy_away1' style="cursor: pointer;color:black;">brazil</span></b>&nbsp;&nbsp;<small style='padding-left: 4px;'>[<span style='color:red'>regular time</span>]</small><br/>
                        <small>FIFA world cup</small><br>
                        <b><span class='copy_home1' style="cursor: pointer;color:black;">China</span> - <span class='copy_away1' style="cursor: pointer;color:black;">Brazil</span></b><br/>
                        <small>world cup</small>
                    </td>
                    <td>
                        <div class="dropdown">
                            <button type="button" class="btn dropdown-toggle" id="dropdownMenu1" data-toggle="dropdown">hide
                                <span class="caret"></span>
                            </button>
                            <ul class="dropdown-menu" role="menu" aria-labelledby="dropdownMenu1">
                                <li role="presentation" class='hide_event'>
                                    <a role="menuitem" tabindex="-1" href="#">bet365</a>
                                </li>
                                <li role="presentation" class='hide_event'>
                                    <a role="menuitem" tabindex="-1" href="#">marathonbet</a>
                                </li>
                                <li role="presentation" class='hide_event'>
                                    <a role="menuitem" tabindex="-1" href="#"><span>marathonbet</span> and <span>bet365</span></a>
                                </li>
                            </ul>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>盘口</td>
                    <td>网站</td>
                    <td>赔率</td>
                    <td>投注金额</td>
                    <td>币种</td>
                    <td></td>
                    <td>收入</td>
                </tr>
                <tr>
                    <td>
                        <span style="font-size: 13px">TO(1)</span><br/>
                        <span style="font-size: 13px">TU(2)</span>
                    </td>
                    <td>
                        <span style="margin-right: 20px;">bet365</span><br>
                        <span style="margin-right: 20px;">marathon</span>
                    </td>
                    <td>
                        <input type='text' name='koef' class='koef1' value='1.42' style='width:50px; height: 20px;' /><br>
                        <input type='text' name='koef' class='koef2' value='2.2' style='width:50px; height: 20px; margin-top:2px'>
                    </td>
                    <td>
                        <input type='text' name='stake' class='stake1' value='' style='width:60px; height: 20px;' /><br>
                        <input type='text' name='stake' class='stake2' value='' style='width:60px; height: 20px; margin-top:2px'>
                    </td>
                    <td>
                        <select name="currency" id="currency" style="width:60px; height:20px; background-color: white">
                            <option value="RUB">RUB</option>
                        </select><br>
                        <select name="currency" id="currency" style="width:60px; height: 20px; margin-top: 2px; background-color: white;">
                            <option value="RUB">RUB</option>
                        </select>
                        <!-- <input type="text" style="width:50px; height: 20px;"><br>
                        <input type="text" style="width:50px; height: 20px; margin-top:2px"> -->
                    </td>
                    <td></td>
                    <td>
                        <span>0</span><br>
                        <span>0</span>
                    </td>
                </tr>
                <tr>
                    <td></td>
                    <td></td>
                    <td></td>
                    <td>
                        <input type='text' class='total_stake' value='7000' style='width:60px; height: 20px;' /><br>
                    </td>
                    <td>
                        <select name="currency" id="currency" style="width:60px; height: 20px; margin-top: 2px; background-color: white;">
                            <option value="RUB">RUB</option>
                        </select>
                    </td>
                    <td></td>
                    <td></td>
                </tr>
            </table>
        </div>
        <div class="col-md-6 col-md-pull-6 tables" style='overflow: auto; max-height: 800px; min-height:240px; border:3px solid #444; padding:0px;'>
            <!-- 暂时没有数据 -->
            <div><h4 class='now_time'></h4></div>
            <table class="table table-condensed bets">
                <!-- <tr>暂时没有数据！</tr> -->
            </table>
        </div>
        <!-- <div class="col-md-6 col-md-push-6" style="padding: 3px;">我在右下边</div> -->
    </div>
    <div class="sites" style='display: none;'>
        <label for="">全选</label>
        <input type="checkbox" class='all' value='all'><br />
        <label for="">Bet365</label>
        <input type="checkbox" class='checkbox_style' value="Bet365">
        <label for="">Marathon</label>
        <input type="checkbox" class='checkbox_style' value="Marathon">
        <label for="">188bet</label>
        <input type="checkbox" class='checkbox_style' value="188bet">
        <label for="">Pinnacle</label>
        <input type="checkbox" class='checkbox_style' value="Pinnacle">
    </div>
    <textarea id='input'></textarea>
</body>
    <script>
        $(function() {

            var hide_sites = Array();
            // $('.btn_login').hide();
            window.setInterval(get_one_data, 1000);
            function get_one_data(){
                $.ajax({
                    type: 'GET',
                    url: '/get_one_data/',
                    success: function(res) {
                        res_len = (res.data).length;
                        hide_num = hide_sites.length;
                        console.log('hide_num:' + hide_num);
                        if(hide_num > 0) {
                            now_index = get_index(hide_sites);
                            console.log(now_index);
                            if(now_index != -1) {
                                hide_sites.splice(now_index, 1);
                            }
                        }
                        console.log(res_len);
                        if(res.is_login == false) {
                            $('.btn_logout').hide();
                            $('.btn_login').show();
                        } else {
                            $('.btn_login').hide();
                            $('.btn_logout').show();
                        }
                        add_html(res.data, res.now_time);
                    }
                });
            }
            
            // 返回所有的索引
            function get_index(datas) {
                num = datas.length;
                now_timestamp = Date.parse(new Date());
                lack_time = 1000*60*60*2; 
                for(var nt=0;nt<num;nt++) {
                    if((datas[nt]['timestamp'] + lack_time) <= now_timestamp){
                        return nt
                    }    
                }
                return -1
            }

            //用户登录
            $('.btn_login').click(function() {
                $.ajax({
                    type: 'GET',
                    url: '/login/',
                    success: function(res) {
                        if(res.status){
                            layer.msg('登录成功！');
                            $('.btn_logout').show();
                            $('.btn_login').hide();
                        } else {
                            layer.msg('登录失败！');
                            $('.btn_login').show();
                            $('.btn_logout').hide();
                        }
                    }
                });
            });

            //用户退出
            $('.btn_logout').click(function() {
                $.ajax({
                    type: 'GET',
                    url: '/logout/',
                    success: function(res) {
                        if(res.status) {
                            layer.msg('退出成功！');
                            $('.btn_login').show();
                            $('.btn_logout').hide();
                        } else {
                            layer.msg('退出失败！');
                        }
                    }
                });
            });

            //隐藏网站以及对应的比赛
            $('.hide_event').click(function() {
                console.log(hide_sites);
                var one_site = Array();
                var one_site2 = Array();
                sport = ''
                home_away1 = ''
                home_away2 = ''
                bookmaker1 = ''
                bookmaker2 = ''
                is_push1 = true;
                is_push2 = true;
                
                now_bookmaker = $(this).children('a').text();
                now_index = $(this).index();
                sport = $('.calculator').find('tr').eq(0).children('td').eq(0).children('b').eq(0).text();
                home_away1 = $('.calculator').find('tr').eq(0).children('td').eq(1).children('b').eq(0).text();
                home_away2 = $('.calculator').find('tr').eq(0).children('td').eq(1).children('b').eq(1).text();
                bookmaker1 = $('.calculator').find('tr').eq(2).children('td').eq(1).children('span').eq(0).text();
                bookmaker2 = $('.calculator').find('tr').eq(2).children('td').eq(1).children('span').eq(1).text();
                
                one_site.splice(0, one_site.length);
                one_site2.splice(0, one_site2.length);
                one_site['sport'] = sport
                one_site2['sport'] = sport
                hide_sites_len = hide_sites.length
                if(now_index == 0) {
                    if(hide_sites_len > 0) {
                        for(var i=0; i<hide_sites_len; i++) {
                            if((hide_sites[i]['home_away'] == home_away1) && (hide_sites[i]['bookmaker'] == bookmaker1)) {
                                is_push1 = false;
                            }
                        }
                    }
                    console.log('0:' + is_push1);
                    if(is_push1 == true) {
                        one_site['home_away'] = home_away1
                        one_site['bookmaker'] = bookmaker1
                        one_site['timestamp'] = Date.parse(new Date());
                        hide_sites.push(one_site);
                    }
                } else if(now_index == 1) {
                    if(hide_sites_len > 0) {
                        for(var j=0; j<hide_sites_len; j++) {
                            if((hide_sites[j]['home_away'] == home_away2) && (hide_sites[j]['bookmaker'] == bookmaker2)) {
                                is_push2 = false;
                            }
                        }
                    }
                    console.log('1:' + is_push2);
                    if(is_push2 == true) {
                        one_site2['home_away'] = home_away2
                        one_site2['bookmaker'] = bookmaker2
                        one_site2['timestamp'] = Date.parse(new Date());
                        hide_sites.push(one_site2);
                    }
                } else {
                    if(hide_sites_len > 0) {
                        for(var k=0; k<hide_sites_len; k++) {
                            if(hide_sites[k]['sport'] == sport) {
                                if(hide_sites[k]['home_away'] == home_away1 && hide_sites[k]['bookmaker'] == bookmaker1) {
                                    is_push1 = false 
                                }
                                if(hide_sites[k]['home_away'] == home_away2 && hide_sites[k]['bookmaker'] == bookmaker2) {
                                    is_push2 = false 
                                }
                            }
                        }
                    }

                    console.log('2:' + is_push1);
                    console.log('2:' + is_push2);
                    if((is_push1 == true) && (is_push2 == false)) {
                        one_site['home_away'] = home_away1
                        one_site['bookmaker'] = bookmaker1
                        one_site['timestamp'] = Date.parse(new Date());
                        hide_sites.push(one_site);
                    } else if((is_push1 == false) && (is_push2 == true)) {
                        one_site2['home_away'] = home_away2
                        one_site2['bookmaker'] = bookmaker2
                        one_site2['timestamp'] = Date.parse(new Date());
                        hide_sites.push(one_site2);
                        hide_sites.push(one_site2);
                    } else if((is_push1 == true) && (is_push2 == true)) {
                        one_site['home_away'] = home_away1
                        one_site['bookmaker'] = bookmaker1
                        one_site['timestamp'] = Date.parse(new Date());
                        hide_sites.push(one_site);
                        one_site2['home_away'] = home_away2
                        one_site2['bookmaker'] = bookmaker2
                        one_site2['timestamp'] = Date.parse(new Date());
                        hide_sites.push(one_site2);
                        hide_sites.push(one_site2);
                    } else {
                        return
                    }
                }

                console.log(hide_sites);
                // if(now_index == 0) {
                //     data = {'sport': sport, 'home_away1':home_away1, 'bookmaker1':bookmaker1, 'home_away2':'', 'bookmaker2':''}
                // } else if(now_index == 1) {
                //     data = {'sport': sport, 'home_away1':'', 'bookmaker1':'', 'home_away2':home_away2, 'bookmaker2':bookmaker2}
                // } else {
                //     data = {'sport': sport, 'home_away1':home_away1, 'bookmaker1':bookmaker1, 'home_away2':home_away2, 'bookmaker2':bookmaker2}
                // }
                // $.ajax({
                //     type: 'get',
                //     url: '/hide_event/',
                //     data: data,
                //     success: function(res) {
                //         if(res.hide == true) {
                //             layer.msg('隐藏成功！');
                //             $('.calculator').hide();
                //         } else if(res.hide == 'repeat') {
                //             layer.msg('已经重复隐藏了！');
                //         } else {
                //             layer.msg('隐藏失败！');
                //         }
                //     }
                // });
            });

            // 选择要显示的网址
            var sites = Array();
            $('.btn_sites').click(function() {
                layer.open({
                    title: '<span style="">请选择<b>最少两个</b>网址！</span>',
                    type: 1,
                    area: ['600px', '360px'],
                    btn: ['确定', '退出'],
                    shadeClose: true,
                    content: $('.sites'),
                    yes: function(index) {
                        sites.splice(0, sites.length)
                        $('.checkbox_style').each(function() {
                            is_true = $(this).is(':checked');
                            if(is_true) {
                                sites.push($(this).val());
                            }
                        });
                        layer.close(index);
                    }
                });
            });

            // 全选网址
            $('.all').click(function() {
                if($(this).is(':checked')) {
                    $('.checkbox_style').each(function() {
                        $(this).prop('checked', true);
                    });
                } else {
                    $('.checkbox_style').each(function() {
                        $(this).prop('checked', false);
                    });
                }
            });
            // 单选网址
            $('.checkbox_style').click(function() {
                var children_checkbox = $(this).is(':checked');
                var parent_checkbox = $('.all').is(':checked');
                input_len = $('.all').siblings('input').length;
                true_num = 0 
                false_num = 0
                $('.all').siblings('input').each(function() {
                    now_checkbox = $(this).is(':checked');
                    if(now_checkbox == true) {
                        true_num += 1;
                    } else {
                        false_num += 1;
                    }
                    if(true_num == input_len) {
                        $('.all').prop('checked', true);
                    } 
                    if(false_num == input_len) {
                        $('.all').prop('checked', false);
                    }
                    if(false_num > 0 && false_num < input_len) {
                        $('.all').prop('checked', false);
                    }
                });
            });

            // ======================================================================
            // 添加数据到html中
            function add_html(res, now_time) {
                // 测试数据 res = [{'bet2': {'bet_value': '', 'league': 'ITF. France. Perigueux. Women. Singles. Round of 32', 'bv_id': 2, 'bet_variation_name': 'ML2', 'bet2_id': 502706295049, 'current_score': '1:1 (15:30)', 'bc_id': 2, 'period': '3 game', 'koef': 1.69, 'updated_at': 1529999402, 'market_depth': '', 'period_id': 16, 'home': 'Albie, Audrey', 'bookmaker': 'Marathon', 'created_at': 1529998946, 'started_at': 1529998507, 'away': 'Tubello, Alice', 'bookmaker_url': 'http://www.marathonbet.com/en/'}, 'bet1': {'bet_value': '', 'league': 'ITF Women Perigueux', 'bv_id': 1, 'bet_variation_name': 'ML1', 'updated_at': 1529999416, 'bet1_id': 502706414059, 'bc_id': 1, 'period': '3 game', 'koef': 4.5, 'market_depth': '', 'period_id': 16, 'home': 'Audrey Albie', 'bookmaker': 'Bet365', 'created_at': 1529999012, 'started_at': 1529997773, 'away': 'Alice Tubello', 'bookmaker_url': 'http://www.bet365.com/en/', 'current_score': '1:1'}, 'event_id': 20463964, 'percent': 22.859, 'paused': false, 'middle_value': 0.0, 'sport': 'Tennis'}, {'bet2': {'bet_value': '', 'league': 'ITF Women Perigueux', 'bv_id': 2, 'bet_variation_name': 'ML2', 'bet2_id': 502706559358, 'current_score': '1:1', 'bc_id': 2, 'period': '3 game', 'koef': 5.0, 'updated_at': 1529999418, 'market_depth': '', 'period_id': 16, 'home': 'Montserrat Gonzalez', 'bookmaker': 'Bet365', 'created_at': 1529999089, 'started_at': 1529997774, 'away': 'Mari Osaka', 'bookmaker_url': 'http://www.bet365.com/en/'}, 'bet1': {'bet_value': '', 'league': 'ITF. France. Perigueux. Women. Singles. Round of 32', 'bv_id': 1, 'bet_variation_name': 'ML1', 'updated_at': 1529999417, 'bet1_id': 502706441920, 'bc_id': 1, 'period': '3 game', 'koef': 1.44, 'market_depth': '', 'period_id': 16, 'home': 'Gonzalez, Montserrat', 'bookmaker': 'Marathon', 'created_at': 1529999024, 'started_at': 1529998601, 'away': 'Osaka, Mari', 'bookmaker_url': 'http://www.marathonbet.com/en/', 'current_score': '1:1 (15:0)'}, 'event_id': 20463961, 'percent': 11.801, 'paused': false, 'middle_value': 0.0, 'sport': 'Tennis'}, {'bet2': {'bet_value': '', 'league': 'ITF. Romania. Curtea de Arges. Women. Singles. Round of 32', 'bv_id': 2, 'bet_variation_name': 'ML2', 'bet2_id': 502706427388, 'current_score': '4:5 (0:30)', 'bc_id': 2, 'period': '', 'koef': 1.189, 'updated_at': 1529999416, 'market_depth': '', 'period_id': 23, 'home': 'Ganga, Eugenia', 'bookmaker': 'Marathon', 'created_at': 1529999018, 'started_at': 1529996760, 'away': 'Mihaylova, Gebriela', 'bookmaker_url': 'http://www.marathonbet.com/en/'}, 'bet1': {'bet_value': '', 'league': 'ITF Women Curtea de Arges', 'bv_id': 1, 'bet_variation_name': 'ML1', 'updated_at': 1529999417, 'bet1_id': 502706507350, 'bc_id': 1, 'period': '', 'koef': 9.0, 'market_depth': '', 'period_id': 23, 'home': 'Eugenia Ganga', 'bookmaker': 'Bet365', 'created_at': 1529999063, 'started_at': 1529995873, 'away': 'Gebriela Mihaylova', 'bookmaker_url': 'http://www.bet365.com/en/', 'current_score': '4:5'}, 'event_id': 20463811, 'percent': 5.025, 'paused': false, 'middle_value': 0.0, 'sport': 'Tennis'}, {'bet2': {'bet_value': '', 'league': 'ITF. Israel. Kiryat Shmona. Men. Singles. Round of 32', 'bv_id': 2, 'bet_variation_name': 'ML2', 'bet2_id': 502700363953, 'current_score': '0:1 (5:7, 3:0) (0:40)', 'bc_id': 2, 'period': 'with OT', 'koef': 1.48, 'updated_at': 1529999387, 'market_depth': '', 'period_id': 3, 'home': 'Sarouk, Yair', 'bookmaker': 'Marathon', 'created_at': 1529994887, 'started_at': 1529994887, 'away': 'Luria, Emmanuel', 'bookmaker_url': 'http://www.marathonbet.com/en/'}, 'bet1': {'bet_value': '', 'league': 'ITF Israel F11', 'bv_id': 1, 'bet_variation_name': 'ML1', 'updated_at': 1529999419, 'bet1_id': 502699628155, 'bc_id': 1, 'period': 'with OT', 'koef': 3.5, 'market_depth': '', 'period_id': 3, 'home': 'Yair Sarouk', 'bookmaker': 'Bet365', 'created_at': 1529994073, 'started_at': 1529994073, 'away': 'Emmanuel Luria', 'bookmaker_url': 'http://www.bet365.com/en/', 'current_score': '5:7,3:1'}, 'event_id': 20463766, 'percent': 4.016, 'paused': false, 'middle_value': 0.0, 'sport': 'Tennis'}, {'bet2': {'bet_value': '', 'league': 'ITF Women Perigueux', 'bv_id': 2, 'bet_variation_name': 'ML2', 'bet2_id': 502704398140, 'current_score': '0:1', 'bc_id': 2, 'period': 'with OT', 'koef': 1.44, 'updated_at': 1529999406, 'market_depth': '', 'period_id': 3, 'home': 'Abbie Myers', 'bookmaker': 'Bet365', 'created_at': 1529997783, 'started_at': 1529997783, 'away': 'Varvara Gracheva', 'bookmaker_url': 'http://www.bet365.com/en/'}, 'bet1': {'bet_value': '', 'league': 'ITF. France. Perigueux. Women. Singles. Round of 32', 'bv_id': 1, 'bet_variation_name': 'ML1', 'updated_at': 1529999411, 'bet1_id': 502705533466, 'bc_id': 1, 'period': 'with OT', 'koef': 3.45, 'market_depth': '', 'period_id': 3, 'home': 'Myers, Abbie', 'bookmaker': 'Marathon', 'created_at': 1529998519, 'started_at': 1529998519, 'away': 'Gracheva, Varvara', 'bookmaker_url': 'http://www.marathonbet.com/en/', 'current_score': '0:2 (30:30)'}, 'event_id': 20463958, 'percent': 1.595, 'paused': false, 'middle_value': 0.0, 'sport': 'Tennis'}]
                if(res.length == 0 && now_time == null){
                    $('.bets').empty();
                    $('.bets').append("<tr><td><h4>暂时没有数据！</h4></td></tr>");
                    return false;
                }
                if(res.length > 0) {
                    $('.bets').empty();
                }
                $('.now_time').empty();
                $('.now_time').append(now_time);
                var trs0 = '';
                var trs1 = '';
                var trs2 = '';
                var trs3 = '';
                sites_num = sites.length;
                hide_sites_num = hide_sites.length;
                for(var i = 0; i < res.length; i++){
                    datas = res[i]
                    if(sites_num > 1) {
                        is_in1 = false; 
                        is_in2 = false; 
                        for(var j = 0; j < sites_num; j++) {
                            if(sites[j] == datas['bet1']['bookmaker']){
                                is_in1 = true;
                            }
                        }
                        for(var k = 0; k < sites_num; k++) {
                            if(sites[k] == datas['bet2']['bookmaker']){
                                is_in2 = true;
                            }
                        }
                        if(hide_sites_num > 0) {
                            is_hide1 = true;
                            is_hide2 = true;
                            for(var m = 0; m < hide_sites_num; m++) {
                                if(hide_sites[m]['sport'] == datas['sport']) {
                                    if((hide_sites[m]['bookmaker'] == datas['bet1']['bookmaker']) && (hide_sites[m]['home_away'] == (datas['bet1']['home'] + ' - ' + datas['bet1']['away']))) {
                                        is_hide1 = false;
                                    }    
                                    if((hide_sites[m]['bookmaker'] == datas['bet2']['bookmaker']) && (hide_sites[m]['home_away'] == (datas['bet2']['home'] + ' - ' + datas['bet2']['away']))) {
                                        is_hide2 = false;
                                    }    
                                }
                            }
                            if(is_hide1 && is_hide2 && is_in1 && is_in2) {
                                trs1 = '';
                                trs2 = '';
                                trs3 = '';
                                trs1 = "<tr class='header_banner'><td colspan='3'>"
                                + "<span style='font-weight: bold; font-size: 16px; color:white;'>" + datas['percent'].toFixed(2) + "%</span>"
                                + "<span style='font-weight: bold; font-size: 16px; color:white; margin-left:26px;'>" + datas['sport'] + '</span><small style="padding-left:5px;color:white;">' + datas['bet1']['period'] + '</small></td>'
                                + "<td><button class='open_calculator btn btn-primary btn-block'>计算</button>" 
                                + "</td></tr>";
                                trs2 = "<tr><td><b style='padding-left:5px;'>" + datas['bet1']['bookmaker'] + "</b><br /><small style='padding-left:5px;'>" + datas['bet1']['current_score'] + "</small></td>"
                                + "<td><b><span id='copy' class='copy_home' style='cursor:pointer'>" + datas['bet1']['home'] + "</span> - <span style='cursor:pointer' class='copy_away'>" + datas['bet1']['away'] + "</span></b><br /><small>" + datas['bet1']['league'] + "</small></td>"
                                + "<td><span>" + datas['bet1']['bet_variation_name'] + "</span></td><td><b style='padding-left:10px;'>" + datas['bet1']['koef'] + "</b></td>"
                                + "</td></tr>";
                                trs3 = "<tr><td><b style='padding-left:5px'>" + datas['bet2']['bookmaker'] + "</b><br /><small style='padding-left:5px;'>" + datas['bet2']['current_score'] + "</small></td>"
                                + "<td><b><span id='copy' class='copy_home' style='cursor:pointer'>" + datas['bet2']['home'] + "</span> - <span style='cursor:pointer' class='copy_away'>" + datas['bet2']['away'] + "</span></b><br /><small>" + datas['bet2']['league'] + "</small></td>"
                                + "<td><span>" + datas['bet2']['bet_variation_name'] + "</span></td><td><b style='padding-left:10px;'>" + datas['bet2']['koef'] + "</b></td>"
                                + "</td></tr>";
                                trs0 += trs1 + trs2 + trs3;                                
                            }
                        } else {
                            if(is_in1 && is_in2) {
                                trs1 = '';
                                trs2 = '';
                                trs3 = '';
                                trs1 = "<tr class='header_banner'><td colspan='3'>"
                                + "<span style='font-weight: bold; font-size: 16px; color:white;'>" + datas['percent'].toFixed(2) + "%</span>"
                                + "<span style='font-weight: bold; font-size: 16px; color:white; margin-left:26px;'>" + datas['sport'] + '</span><small style="padding-left:5px;color:white;">' + datas['bet1']['period'] + '</small></td>'
                                + "<td><button class='open_calculator btn btn-primary btn-block'>计算</button>" 
                                + "</td></tr>";
                                trs2 = "<tr><td><b style='padding-left:5px;'>" + datas['bet1']['bookmaker'] + "</b><br /><small style='padding-left:5px;'>" + datas['bet1']['current_score'] + "</small></td>"
                                + "<td><b><span id='copy' class='copy_home' style='cursor:pointer'>" + datas['bet1']['home'] + "</span> - <span style='cursor:pointer' class='copy_away'>" + datas['bet1']['away'] + "</span></b><br /><small>" + datas['bet1']['league'] + "</small></td>"
                                + "<td><span>" + datas['bet1']['bet_variation_name'] + "</span></td><td><b style='padding-left:10px;'>" + datas['bet1']['koef'] + "</b></td>"
                                + "</td></tr>";
                                trs3 = "<tr><td><b style='padding-left:5px'>" + datas['bet2']['bookmaker'] + "</b><br /><small style='padding-left:5px;'>" + datas['bet2']['current_score'] + "</small></td>"
                                + "<td><b><span id='copy' class='copy_home' style='cursor:pointer'>" + datas['bet2']['home'] + "</span> - <span style='cursor:pointer' class='copy_away'>" + datas['bet2']['away'] + "</span></b><br /><small>" + datas['bet2']['league'] + "</small></td>"
                                + "<td><span>" + datas['bet2']['bet_variation_name'] + "</span></td><td><b style='padding-left:10px;'>" + datas['bet2']['koef'] + "</b></td>"
                                + "</td></tr>";
                                trs0 += trs1 + trs2 + trs3;
                            }
                        }
                    } else {
                        if(hide_sites_num > 0) {
                            no_site_is_hide1 = true;
                            no_site_is_hide2 = true;
                            for(var m = 0; m < hide_sites_num; m++) {
                                if(hide_sites[m]['sport'] == datas['sport']) {
                                    if((hide_sites[m]['bookmaker'] == datas['bet1']['bookmaker']) && (hide_sites[m]['home_away'] == (datas['bet1']['home'] + ' - ' + datas['bet1']['away']))) {
                                        no_site_is_hide1 = false;
                                    }    
                                    if((hide_sites[m]['bookmaker'] == datas['bet2']['bookmaker']) && (hide_sites[m]['home_away'] == (datas['bet2']['home'] + ' - ' + datas['bet2']['away']))) {
                                        no_site_is_hide2 = false;
                                    }    
                                }
                            }                            
                            if(no_site_is_hide1 && no_site_is_hide2) {
                                trs1 = '';
                                trs2 = '';
                                trs3 = '';
                                trs1 = "<tr class='header_banner'><td colspan='3'>"
                                + "<span style='font-weight: bold; font-size: 16px; color:white;'>" + datas['percent'].toFixed(2) + "%</span>"
                                + "<span style='font-weight: bold; font-size: 16px; color:white; margin-left:26px;'>" + datas['sport'] + '</span><small style="padding-left:5px;color:white;">' + datas['bet1']['period'] + '</small></td>'
                                + "<td><button class='open_calculator btn btn-primary btn-block'>计算</button>" 
                                + "</td></tr>";
                                trs2 = "<tr><td><b style='padding-left:5px;'>" + datas['bet1']['bookmaker'] + "</b><br /><small style='padding-left:5px;'>" + datas['bet1']['current_score'] + "</small></td>"
                                + "<td><b><span id='copy' class='copy_home' style='cursor:pointer'>" + datas['bet1']['home'] + "</span> - <span style='cursor:pointer' class='copy_away'>" + datas['bet1']['away'] + "</span></b><br /><small>" + datas['bet1']['league'] + "</small></td>"
                                + "<td><span>" + datas['bet1']['bet_variation_name'] + "</span></td><td><b style='padding-left:10px;'>" + datas['bet1']['koef'] + "</b></td>"
                                + "</td></tr>";
                                trs3 = "<tr><td><b style='padding-left:5px'>" + datas['bet2']['bookmaker'] + "</b><br /><small style='padding-left:5px;'>" + datas['bet2']['current_score'] + "</small></td>"
                                + "<td><b><span id='copy' class='copy_home' style='cursor:pointer'>" + datas['bet2']['home'] + "</span> - <span style='cursor:pointer' class='copy_away'>" + datas['bet2']['away'] + "</span></b><br /><small>" + datas['bet2']['league'] + "</small></td>"
                                + "<td><span>" + datas['bet2']['bet_variation_name'] + "</span></td><td><b style='padding-left:10px;'>" + datas['bet2']['koef'] + "</b></td>"
                                + "</td></tr>";
                                trs0 += trs1 + trs2 + trs3;                                
                            }
                        } else {
                            trs1 = "<tr class='header_banner'><td colspan='3'>"
                            + "<span style='font-weight: bold; font-size: 16px; color:white;'>" + datas['percent'].toFixed(2) + "%</span>"
                            + "<span style='font-weight: bold; font-size: 16px; color:white; margin-left:26px;'>" + datas['sport'] + '</span><small style="padding-left:5px;color:white;">' + datas['bet1']['period'] + '</small></td>'
                            + "<td><button class='open_calculator btn btn-primary btn-block'>计算</button>" 
                            + "</td></tr>";
                            trs2 = "<tr><td><b style='padding-left:5px;'>" + datas['bet1']['bookmaker'] + "</b><br /><small style='padding-left:5px;'>" + datas['bet1']['current_score'] + "</small></td>"
                            + "<td><b><span id='copy' class='copy_home' style='cursor:pointer'>" + datas['bet1']['home'] + "</span> - <span style='cursor:pointer' class='copy_away'>" + datas['bet1']['away'] + "</span></b><br /><small>" + datas['bet1']['league'] + "</small></td>"
                            + "<td><span><small>" + datas['bet1']['bet_variation_name'] + "</small></span></td><td><b style='padding-left:10px;'>" + datas['bet1']['koef'] + "</b></td>"
                            + "</td></tr>";
                            trs3 = "<tr><td><b style='padding-left:5px'>" + datas['bet2']['bookmaker'] + "</b><br /><small style='padding-left:5px;'>" + datas['bet2']['current_score'] + "</small></td>"
                            + "<td><b><span id='copy' class='copy_home' style='cursor:pointer'>" + datas['bet2']['home'] + "</span> - <span style='cursor:pointer' class='copy_away'>" + datas['bet2']['away'] + "</span></b><br /><small>" + datas['bet2']['league'] + "</small></td>"
                            + "<td><span><small>" + datas['bet2']['bet_variation_name'] + "</small></span></td><td><b style='padding-left:10px;'>" + datas['bet2']['koef'] + "</b></td>"
                            + "</td></tr>";
                            trs0 += trs1 + trs2 + trs3;
                        }
                    }
                }
                $('.bets').append(trs0);

                // 打开计算器
                $('.open_calculator').on('click', function() {
                    $(this).parents("tr").removeClass('header_banner').addClass('now_active').siblings('.now_active').removeClass('now_active').addClass('header_banner');
                    var percent = $(this).parents("tr").children('td').eq(0).children('span').eq(0).text();
                    var sport = $(this).parents("tr").children('td').eq(0).children('span').eq(1).text();
                    var period = $(this).parents("tr").children('td').eq(0).children('small').eq(0).text();
                    var bookmaker1 = $(this).parents("tr").next().children('td').eq(0).find('b').text();
                    var bookmaker2 = $(this).parents("tr").next().next().children('td').eq(0).find('b').text();
                    var home_away1 = $(this).parents("tr").next().children('td').eq(1).find('b').text();
                    var home_away2 = $(this).parents("tr").next().next().children('td').eq(1).find('b').text();
                    var league1 = $(this).parents("tr").next().children('td').eq(1).find('small').text();
                    var league2 = $(this).parents("tr").next().next().children('td').eq(1).find('small').text();
                    var bet_variation1 = $(this).parents("tr").next().children('td').eq(2).find('span').text();
                    var bet_variation2 = $(this).parents("tr").next().next().children('td').eq(2).find('span').text();
                    var koef1 = $(this).parents("tr").next().children('td').eq(3).find('b').text();
                    var koef2 = $(this).parents("tr").next().next().children('td').eq(3).find('b').text();

                    $('.calculator').find('tr').eq(0).children('td').eq(0).children('b').eq(0).text(sport);
                    $('.calculator').find('tr').eq(0).children('td').eq(0).children('b').eq(1).text(percent);
                    $('.calculator').find('tr').eq(0).children('td').eq(2).children('div').eq(0).find('li').eq(0).find('a').text(bookmaker1);
                    $('.calculator').find('tr').eq(0).children('td').eq(2).children('div').eq(0).find('li').eq(1).find('a').text(bookmaker2);
                    $('.calculator').find('tr').eq(0).children('td').eq(2).children('div').eq(0).find('li').eq(2).children('a').children('span').eq(0).text(bookmaker1);
                    $('.calculator').find('tr').eq(0).children('td').eq(2).children('div').eq(0).find('li').eq(2).children('a').children('span').eq(1).text(bookmaker2);

                    home_away1_arr = home_away1.split(' - ')
                    home1 = home_away1_arr[0]
                    away1 = home_away1_arr[1]
                    home_away2_arr = home_away2.split(' - ')
                    home2 = home_away2_arr[0]
                    away2 = home_away2_arr[1]

                    $('.calculator').find('tr').eq(0).children('td').eq(1).children('b').eq(0).children('span').eq(0).text(home1);
                    $('.calculator').find('tr').eq(0).children('td').eq(1).children('b').eq(0).children('span').eq(1).text(away1);
                    $('.calculator').find('tr').eq(0).children('td').eq(1).children('b').eq(1).children('span').eq(0).text(home2);
                    $('.calculator').find('tr').eq(0).children('td').eq(1).children('b').eq(1).children('span').eq(1).text(away2);
                    $('.calculator').find('tr').eq(0).children('td').eq(1).find('b').attr('homeaway2', home_away2)
                    $('.calculator').find('tr').eq(0).children('td').eq(1).children('small').eq(0).children('span').eq(0).text(period);
                    $('.calculator').find('tr').eq(0).children('td').eq(1).children('small').eq(1).text(league1);
                    $('.calculator').find('tr').eq(0).children('td').eq(1).children('small').eq(2).text(league2);
                    $('.calculator').find('tr').eq(2).children('td').eq(0).children('span').eq(0).text(bet_variation1);
                    $('.calculator').find('tr').eq(2).children('td').eq(0).children('span').eq(1).text(bet_variation2);
                    $('.calculator').find('tr').eq(2).children('td').eq(1).children('span').eq(0).text(bookmaker1);
                    $('.calculator').find('tr').eq(2).children('td').eq(1).children('span').eq(1).text(bookmaker2);
                    $('.calculator').find('tr').eq(2).children('td').eq(2).children('input').eq(0).val(koef1);
                    $('.calculator').find('tr').eq(2).children('td').eq(2).children('input').eq(1).val(koef2);

                    // 如果出现bet365时，默认复制bet365主队
                    if(bookmaker1 == 'Bet365') {
                        var input = document.getElementById("input");
                        input.value = home1;
                        input.select();
                        document.execCommand("Copy");
                    } else if(bookmaker2 == 'Bet365') {
                        var input = document.getElementById("input");
                        input.value = home2;
                        input.select();
                        document.execCommand("Copy");
                    } 

                    /// 如果是marathon默认投注金额为2000
                    if(bookmaker1 == 'Marathon') {
                        stake1 = 2000    
                        stake2 = ((stake1 * koef1)/koef2).toFixed(2);
                        stake = parseFloat(stake1) + parseFloat(stake2)
                    } else if(bookmaker2 == 'Marathon') {
                        stake2 = 2000
                        stake1 = ((stake2 * koef2)/koef1).toFixed(2);
                        stake = parseFloat(stake1) + parseFloat(stake2)
                    } else {
                        stake = 3000;
                        stake1 = (((1/koef1)/((1/koef1) + (1/koef2)))*stake).toFixed(2); 
                        stake2 = (((1/koef2)/((1/koef1) + (1/koef2)))*stake).toFixed(2); 
                    }
                    profit1 = (stake1 * koef1 - stake).toFixed(2);
                    profit2 = (stake2 * koef2 - stake).toFixed(2);
                    $('.calculator').find('tr').eq(3).children('td').eq(3).children('input').eq(0).val(stake.toFixed(2));
                    $('.calculator').find('tr').eq(2).children('td').eq(3).children('input').eq(0).val(stake1);
                    $('.calculator').find('tr').eq(2).children('td').eq(3).children('input').eq(1).val(stake2);
                    $('.calculator').find('tr').eq(2).children('td').eq(6).find('span').eq(0).text(profit1);
                    $('.calculator').find('tr').eq(2).children('td').eq(6).find('span').eq(1).text(profit2);
                    $('.calculator').show();
                });
                $('.copy_home').on('click', function() {
                    home = $(this).text();
                    var input = document.getElementById("input");
                    input.value = home;
                    input.select();
                    document.execCommand("Copy");
                    layer.msg('复制成功！');
                });
                $('.copy_away').on('click', function() {
                    away = $(this).text();
                    var input = document.getElementById("input");
                    input.value = away;
                    input.select();
                    document.execCommand("Copy");
                    layer.msg('复制成功！');
                });
            }
            $('.copy_home1').on('click', function() {
                home = $(this).text();
                var input = document.getElementById("input");
                input.value = home;
                input.select();
                document.execCommand("Copy");
                layer.msg('复制成功！');
            });
            $('.copy_away1').on('click', function() {
                home = $(this).text();
                var input = document.getElementById("input");
                input.value = home;
                input.select();
                document.execCommand("Copy");
                layer.msg('复制成功！');
            });

            //判断输入值是否合理
            function is_need_value(input_val) {
                val_length = input_val.length
                if(val_length == 0){
                    return '' 
                }
                if(val_length == 1) {
                    if(isNaN(parseFloat(input_val))) {
                        return ''
                    }
                }
                last_cha = input_val.substr(val_length-1, val_length)
                old_input_val = input_val.substr(0, val_length-1)
                old_input_val_length = old_input_val.length
                if(last_cha == '.' && old_input_val.indexOf('.') == -1) {
                    return input_val;
                } else if(last_cha == 0) {
                    return input_val
                } else if(old_input_val.substr(old_input_val_length-1, old_input_val_length) == '.' && isNaN(last_cha)) {
                    return old_input_val
                } else {
                    return parseFloat(input_val)
                }
            }

            $('.koef1').keyup(function() {
                koef2 = $('.calculator').find('tr').eq(2).children('td').eq(2).children('input').eq(1).val();
                stake = $('.calculator').find('tr').eq(3).children('td').eq(3).children('input').eq(0).val();
                stake1 = $('.calculator').find('tr').eq(2).children('td').eq(3).children('input').eq(0).val();
                stake2 = $('.calculator').find('tr').eq(2).children('td').eq(3).children('input').eq(1).val();
                koef1 = $('.calculator').find('tr').eq(2).children('td').eq(2).children('input').eq(0).val();
                bookmaker1 = $('.calculator').find('tr').eq(2).children('td').eq(1).children('span').eq(0).text();
                bookmaker2 = $('.calculator').find('tr').eq(2).children('td').eq(1).children('span').eq(1).text();
                koef1 = is_need_value(koef1);
                $('.calculator').find('tr').eq(2).children('td').eq(2).children('input').eq(0).val(koef1);
                if(koef1 == '' || koef2 == '' || stake == '') {
                    return false;
                } else {
                    if(bookmaker1 == 'Marathon') {
                        stake2 = ((koef1*stake1)/koef2).toFixed(2); 
                        $('.calculator').find('tr').eq(2).children('td').eq(3).children('input').eq(1).val(stake2);
                    } else if(bookmaker2 == 'Marathon') {
                        stake1 = ((koef2*stake2)/koef1).toFixed(2); 
                        $('.calculator').find('tr').eq(2).children('td').eq(3).children('input').eq(0).val(stake1);
                    } else {
                        // stake1 = (((1/koef1)/((1/koef1) + (1/koef2)))*stake).toFixed(2); 
                        // stake2 = (((1/koef2)/((1/koef1) + (1/koef2)))*stake).toFixed(2); 
                        stake2 = ((koef1*stake1)/koef2).toFixed(2); 
                        $('.calculator').find('tr').eq(2).children('td').eq(3).children('input').eq(1).val(stake2);
                    }
                    stake = parseFloat(stake1) + parseFloat(stake2);
                    profit1 = (stake1 * koef1 - stake).toFixed(2);
                    profit2 = (stake2 * koef2 - stake).toFixed(2);
                    profit_percent = ((profit1/stake) * 100).toFixed(2);
                    $('.calculator').find('tr').eq(0).children('td').eq(0).children('b').eq(1).text(profit_percent + '%');
                    $('.calculator').find('tr').eq(3).children('td').eq(3).children('input').eq(0).val(stake);
                    $('.calculator').find('tr').eq(2).children('td').eq(6).find('span').eq(0).text(profit1);
                    $('.calculator').find('tr').eq(2).children('td').eq(6).find('span').eq(1).text(profit2);
                }
            });

            $('.koef2').keyup(function() {
                stake1 = $('.calculator').find('tr').eq(2).children('td').eq(3).children('input').eq(0).val();
                stake2 = $('.calculator').find('tr').eq(2).children('td').eq(3).children('input').eq(1).val();
                koef1 = $('.calculator').find('tr').eq(2).children('td').eq(2).children('input').eq(0).val();
                koef2 = $('.calculator').find('tr').eq(2).children('td').eq(2).children('input').eq(1).val();
                bookmaker1 = $('.calculator').find('tr').eq(2).children('td').eq(1).children('span').eq(0).text();
                bookmaker2 = $('.calculator').find('tr').eq(2).children('td').eq(1).children('span').eq(1).text();
                stake = $('.calculator').find('tr').eq(3).children('td').eq(3).children('input').eq(0).val();
                koef2 = is_need_value(koef2);
                $('.calculator').find('tr').eq(2).children('td').eq(2).children('input').eq(1).val(koef2);
                if(koef2 == '' || koef1 == '' || stake == '') {
                    return false;
                } else {
                    if(bookmaker1 == 'Marathon') {
                        stake2 = ((koef1*stake1)/koef2).toFixed(2); 
                        $('.calculator').find('tr').eq(2).children('td').eq(3).children('input').eq(1).val(stake2);
                    } else if(bookmaker2 == 'Marathon') {
                        stake1 = ((koef2*stake2)/koef1).toFixed(2); 
                        $('.calculator').find('tr').eq(2).children('td').eq(3).children('input').eq(0).val(stake1);
                    } else {
                        stake2 = ((koef1*stake1)/koef2).toFixed(2); 
                        $('.calculator').find('tr').eq(2).children('td').eq(3).children('input').eq(1).val(stake2);
                    }
                    stake = parseFloat(stake1) + parseFloat(stake2);
                    koef1 = $('.calculator').find('tr').eq(2).children('td').eq(2).children('input').eq(0).val();
                    profit1 = (stake1 * koef1 - stake).toFixed(2);
                    profit2 = (stake2 * koef2 - stake).toFixed(2);
                    profit_percent = ((profit1/stake) * 100).toFixed(2);
                    $('.calculator').find('tr').eq(0).children('td').eq(0).children('b').eq(1).text(profit_percent + '%');
                    $('.calculator').find('tr').eq(2).children('td').eq(6).find('span').eq(0).text(profit1);
                    $('.calculator').find('tr').eq(2).children('td').eq(6).find('span').eq(1).text(profit2);
                    $('.calculator').find('tr').eq(3).children('td').eq(3).children('input').eq(0).val(stake);
                }
            });

            $('.stake1').keyup(function() {
                koef1 = $('.calculator').find('tr').eq(2).children('td').eq(2).children('input').eq(0).val();
                koef2 = $('.calculator').find('tr').eq(2).children('td').eq(2).children('input').eq(1).val();
                bookmaker1 = $('.calculator').find('tr').eq(2).children('td').eq(1).children('span').eq(0).text();
                bookmaker2 = $('.calculator').find('tr').eq(2).children('td').eq(1).children('span').eq(1).text();
                stake1 = $('.calculator').find('tr').eq(2).children('td').eq(3).children('input').eq(0).val();
                stake2 = $('.calculator').find('tr').eq(2).children('td').eq(3).children('input').eq(1).val();
                stake1 = is_need_value(stake1);
                $('.calculator').find('tr').eq(2).children('td').eq(3).children('input').eq(0).val(stake1);
                if(stake1 != ''){
                    if(koef1 == '' || koef2 == '' || stake2 == '') {
                        return false;
                    }
                    if(bookmaker1 == 'Marathon') {
                        stake2 = ((koef1*stake1)/koef2).toFixed(2); 
                        $('.calculator').find('tr').eq(2).children('td').eq(3).children('input').eq(1).val(stake2);
                    } else if(bookmaker2 == 'Marathon') {
                        stake1 = ((koef2*stake2)/koef1).toFixed(2); 
                        $('.calculator').find('tr').eq(2).children('td').eq(3).children('input').eq(0).val(stake1);
                    } else {
                        stake2 = ((koef1*stake1)/koef2).toFixed(2); 
                        $('.calculator').find('tr').eq(2).children('td').eq(3).children('input').eq(1).val(stake2);
                    }
                    stake = parseFloat(stake1) + parseFloat(stake2);
                    $('.calculator').find('tr').eq(3).children('td').eq(3).children('input').eq(0).val(stake.toFixed(2));
                    profit1 = (stake1 * koef1 - stake).toFixed(2);
                    profit2 = (stake2 * koef2 - stake).toFixed(2);
                    profit_percent = ((profit1/stake) * 100).toFixed(2);
                    $('.calculator').find('tr').eq(0).children('td').eq(0).children('b').eq(1).text(profit_percent + '%');
                    $('.calculator').find('tr').eq(2).children('td').eq(6).find('span').eq(0).text(profit1);
                    $('.calculator').find('tr').eq(2).children('td').eq(6).find('span').eq(1).text(profit2);
                }
            });
            $('.stake2').keyup(function() {
                koef1 = $('.calculator').find('tr').eq(2).children('td').eq(2).children('input').eq(0).val();
                koef2 = $('.calculator').find('tr').eq(2).children('td').eq(2).children('input').eq(1).val();
                stake1 = $('.calculator').find('tr').eq(2).children('td').eq(3).children('input').eq(0).val();
                stake2 = $('.calculator').find('tr').eq(2).children('td').eq(3).children('input').eq(1).val();
                bookmaker1 = $('.calculator').find('tr').eq(2).children('td').eq(1).children('span').eq(0).text();
                bookmaker2 = $('.calculator').find('tr').eq(2).children('td').eq(1).children('span').eq(1).text();
                stake2 = is_need_value(stake2);
                $('.calculator').find('tr').eq(2).children('td').eq(3).children('input').eq(1).val(stake2);
                if(stake2 != '') {
                    if(koef1 == '' || koef2 == '' || stake1 == '') {
                        return false;
                    }
                    if(bookmaker1 == 'Marathon') {
                        stake2 = ((koef1*stake1)/koef2).toFixed(2); 
                        $('.calculator').find('tr').eq(2).children('td').eq(3).children('input').eq(1).val(stake2);
                    } else if(bookmaker2 == 'Marathon') {
                        stake1 = ((koef2*stake2)/koef1).toFixed(2); 
                        $('.calculator').find('tr').eq(2).children('td').eq(3).children('input').eq(0).val(stake1);
                    } else {
                        stake1 = ((koef2*stake2)/koef1).toFixed(2); 
                        $('.calculator').find('tr').eq(2).children('td').eq(3).children('input').eq(0).val(stake1);
                    }
                    stake = parseFloat(stake1) + parseFloat(stake2);
                    $('.calculator').find('tr').eq(3).children('td').eq(3).children('input').eq(0).val(stake.toFixed(2));
                    if(koef1 == '' || koef2 == '' || stake1 == '') {
                        return false;
                    }
                    profit1 = (stake1 * koef1 - stake).toFixed(2);
                    profit2 = (stake2 * koef2 - stake).toFixed(2);
                    profit_percent = ((profit1/stake) * 100).toFixed(2);
                    $('.calculator').find('tr').eq(0).children('td').eq(0).children('b').eq(1).text(profit_percent + '%');
                    $('.calculator').find('tr').eq(2).children('td').eq(6).find('span').eq(0).text(profit1);
                    $('.calculator').find('tr').eq(2).children('td').eq(6).find('span').eq(1).text(profit2);
                }
            });

            $('.total_stake').keyup(function() {
                koef1 = $('.calculator').find('tr').eq(2).children('td').eq(2).children('input').eq(0).val();
                koef2 = $('.calculator').find('tr').eq(2).children('td').eq(2).children('input').eq(1).val();
                stake = $('.calculator').find('tr').eq(3).children('td').eq(3).children('input').eq(0).val();
                stake = is_need_value(stake);
                $('.calculator').find('tr').eq(3).children('td').eq(3).children('input').eq(0).val(stake);
                if(stake == '') {
                    $('.calculator').find('tr').eq(2).children('td').eq(3).children('input').eq(0).val(0);
                    $('.calculator').find('tr').eq(2).children('td').eq(3).children('input').eq(1).val(0);
                    $('.calculator').find('tr').eq(2).children('td').eq(6).find('span').eq(0).text(0);
                    $('.calculator').find('tr').eq(2).children('td').eq(6).find('span').eq(1).text(0);
                } else {
                    koef1 = $('.calculator').find('tr').eq(2).children('td').eq(2).children('input').eq(0).val();
                    koef1 = $('.calculator').find('tr').eq(2).children('td').eq(2).children('input').eq(0).val();
                    koef2 = $('.calculator').find('tr').eq(2).children('td').eq(2).children('input').eq(1).val();
                    if(koef1 == '' || koef2 == '') {
                        return false;
                    }
                    stake1 = (((1/koef1)/((1/koef1) + (1/koef2)))*stake).toFixed(2); 
                    stake2 = (((1/koef2)/((1/koef1) + (1/koef2)))*stake).toFixed(2); 
                    profit1 = (stake1 * koef1 - stake).toFixed(2);
                    profit2 = (stake2 * koef2 - stake).toFixed(2);
                    profit_percent = ((profit1/stake) * 100).toFixed(2);
                    $('.calculator').find('tr').eq(0).children('td').eq(0).children('b').eq(1).text(profit_percent + '%');
                    $('.calculator').find('tr').eq(2).children('td').eq(3).children('input').eq(0).val(stake1);
                    $('.calculator').find('tr').eq(2).children('td').eq(3).children('input').eq(1).val(stake2);
                    $('.calculator').find('tr').eq(2).children('td').eq(6).find('span').eq(0).text(profit1);
                    $('.calculator').find('tr').eq(2).children('td').eq(6).find('span').eq(1).text(profit2);
                }
            });

            // 点击输入框全选内容
            $('.total_stake').click(function() {
                $(this).select();
            });
            $('.koef1').click(function() {
                $(this).select();
            });
            $('.koef2').click(function() {
                $(this).select();
            });
            $('.stake1').click(function() {
                $(this).select();
            });
            $('.stake2').click(function() {
                $(this).select();
            });
        });
    </script>
</html>
